// (function() {
    var writeHead = new Vue({
        el:'#write-head',
        data:{
            postData:{
                thumb:qk_write_data.edit_thumb,
                writeTitle:qk_write_data.edit_title,
            },
        },
        methods:{
            showImgUploadBox () {
                this.$createModal('imageUploadBox',{size:400,props:{
                    data:{
                        showTabType:1,
                        maxPicked:1,
                        postType:'post',
                        callback:(data,type) => {
                            this.postData.thumb = data[0]?.url
                        }
                    }
                    
                }})
            }
        },
        watch:{
            
        }
    })
    
    var writeSetting = new Vue({
        el:'#post-setting',
        data:{
            catsOptions:qk_write_data.cats,
            tagsOptions:qk_write_data.tags,
            cats:qk_write_data.edit_cats,
            tags:qk_write_data.edit_tags,
            roleOptions:[{ value: 'none', label: '无限制' }, { value: 'money', label: '支付费用' },{ value: 'credit', label: '支付积分' }, { value: 'roles', label: '限制等级' }, { value: 'login', label: '登录可见' }, { value: 'comment', label: '评论可见' }],
            role:qk_write_data.edit_role,
            loaded:false
        },
        methods:{
            submit(type) {
                
                if(this.loaded) return this.$message({ message: '请勿快速点击提交', type: 'warning' });
                this.loaded = true
                
                //正文
                let content = tinymce.activeEditor.getContent();
                
                let data = {
                    title:writeHead.postData.writeTitle,
                    cats:this.cats,
                    //collections:writeHead.postData.collections, 专题
                    thumb:writeHead.postData.thumb,
                    content:content,
                    role:this.role,
                    tags:this.tags,
                    //excerpt:this.excerpt, //摘要
                    type:type, //公开 或 草稿 类型
                    post_id:qk_write_data.post_id,
                    //from:this.from
                }
                
                this.$http.post(qk_rest_url+'insertPost',data).then(res=>{ //Qs.stringify(data)
                
                    this.$message({ message: res.data.msg, type: 'success' });
                    if(window.location.href != res.data.url) {
                        setTimeout(()=> {
                            location.href = res.data.url
                        }, 1000);
                    }
                }).catch(err=>{
                    this.$message({ message: err.response.data.message, type: 'warning' });
                })
            }
        },
        watch:{
            
        }
    })
    
    window.writeFooter = writeSetting
    window.writeHead = writeHead
    //window.writeEditor = writeEditor
// }).call(this);